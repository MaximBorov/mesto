!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){},function(e,t,n){"use strict";n.r(t);n(0);var r={formSelector:".popup__container",inputSelector:".popup__input",submitButtonSelector:".popup__submit-button",inactiveButtonClass:"popup__submit-button_type_error",inputErrorClass:"popup__input_type_error",errorClass:".popup__text-error"};function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(t,n,o,i,u,c,a,s){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.likes=t.likes,this._title=t.name,this._link=t.link,this.cardId=t._id,this._ownerId=t.owner._id,this._cardSelector=n,this._myId=o,this._confirmPopup=i,this._deleteCard=u,this._createLike=c,this._deleteLike=a,this._submitConfirm=i._popup.querySelector(r.formSelector),this._handleCardClick=s}var t,n,i;return t=e,(n=[{key:"_getTemplate",value:function(){return document.querySelector(this._cardSelector).content.querySelector(".card").cloneNode(!0)}},{key:"_checkLike",value:function(e){return this.likes.some((function(t){return t._id===e}))}},{key:"_likeEvent",value:function(e){this._checkLike(this._myId)?(this._deleteLike(this.cardId),e.target.classList.remove("card__like-button_active")):(this._createLike(this.cardId),e.target.classList.add("card__like-button_active"))}},{key:"_trashElement",value:function(){this._confirmPopup.openPopup(),this._submitConfirm.addEventListener("submit",this._deleteCard)}},{key:"_setEventListeners",value:function(){var e=this;this.element.querySelector(".card__image").addEventListener("click",this._handleCardClick),this.element.querySelector("#like").addEventListener("click",(function(t){e._likeEvent(t)})),this._ownerId===this._myId&&this.element.querySelector(".card__trash-button").addEventListener("click",(function(){return e._trashElement(e.cardId)}))}},{key:"likeStart",value:function(e){this._checkLike(this._myId)?e.target.classList.add("card__like-button_active"):e.target.classList.remove("card__like-button_active")}},{key:"deleteListener",value:function(){this._submitConfirm.removeEventListener("submit",this._deleteCard)}},{key:"deleteElement",value:function(){this.element.remove()}},{key:"generateCard",value:function(){this.element=this._getTemplate();var e=this.element.querySelector(".card__image"),t=this.element.querySelector(".card__text"),n=this.element.querySelector(".card__like-button"),r=this.element.querySelector(".card__like-counter");return this.likeStart({target:n}),r.textContent=this.likes.length,this._ownerId!==this._myId&&this.element.querySelector(".card__trash-button").remove(),this._setEventListeners(),e.src=this._link,e.alt=this._title,t.textContent=this._title,this.element}}])&&o(t.prototype,n),i&&o(t,i),e}();function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var c=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._formSelector=t.formSelector,this._inputSelector=t.inputSelector,this._submitButtonSelector=t.submitButtonSelector,this._inactiveButtonClass=t.inactiveButtonClass,this._inputErrorClass=t.inputErrorClass,this._errorClass=t.errorClass,this._form=n}var t,n,o;return t=e,(n=[{key:"_hasInvalidInput",value:function(e){return e.some((function(e){return!e.validity.valid}))}},{key:"_showInputError",value:function(e,t){var n=this._form.querySelector("#".concat(e.id,"-error"));e.classList.add("".concat(this._inputErrorClass)),n.textContent=t}},{key:"_toggleButtonState",value:function(e,t){this._hasInvalidInput(e)?this.offButton(t):this.onButton(t)}},{key:"_checkInputValidity",value:function(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}},{key:"_hideInputError",value:function(e){var t=this._form.querySelector("#".concat(e.id,"-error"));e.classList.remove("".concat(this._inputErrorClass)),t.textContent=""}},{key:"hideInputErrors",value:function(){var e=this;Array.from(this._form.querySelectorAll("".concat(this._inputSelector))).forEach((function(t){e._hideInputError(t)}))}},{key:"offButton",value:function(e){e.classList.add("".concat(r.inactiveButtonClass)),e.setAttribute("disabled",!0)}},{key:"onButton",value:function(e){e.classList.remove("".concat(r.inactiveButtonClass)),e.removeAttribute("disabled")}},{key:"enableValidation",value:function(){var e=this,t=Array.from(this._form.querySelectorAll("".concat(this._inputSelector))),n=this._form.querySelector("".concat(this._submitButtonSelector));this._toggleButtonState(t,n),t.forEach((function(r){r.addEventListener("input",(function(){e._checkInputValidity(r),e._toggleButtonState(t,n)}))}))}}])&&u(t.prototype,n),o&&u(t,o),e}();function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._popup=document.querySelector(t)}var t,n,r;return t=e,(n=[{key:"openPopup",value:function(){this._popup.classList.add("popup_opened")}},{key:"closePopup",value:function(){this._popup.classList.remove("popup_opened")}},{key:"_handleEscClose",value:function(e){27===e.keyCode&&this.closePopup()}},{key:"_handleEmptyClose",value:function(e){e.target.closest(".popup__container")||e.target.closest(".popup__photo-container")||this.closePopup()}},{key:"setEventListeners",value:function(){var e=this,t=this._popup.querySelector(".popup__close-button");addEventListener("keydown",(function(t){return e._handleEscClose(t)})),this._popup.addEventListener("mousedown",(function(t){return e._handleEmptyClose(t)})),t.addEventListener("click",(function(){return e.closePopup()}))}}])&&a(t.prototype,n),r&&a(t,r),e}();function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t,n){return(p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=_(e);if(t){var o=_(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return y(this,n)}}function y(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var v=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(i,e);var t,n,r,o=d(i);function i(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),o.call(this,e)}return t=i,(n=[{key:"openPopup",value:function(e){var t=this._popup.querySelector(".popup__photo-image"),n=this._popup.querySelector(".popup__photo-text");t.alt=e.name,t.src=e.link,n.textContent=e.name,p(_(i.prototype),"openPopup",this).call(this)}}])&&f(t.prototype,n),r&&f(t,r),i}(s);function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function k(e,t,n){return(k="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=P(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function S(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var o=P(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return E(this,n)}}function E(e,t){return!t||"object"!==m(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function P(e){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var w=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}(u,e);var t,n,o,i=S(u);function u(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(n=i.call(this,e))._submitButton=n._popup.querySelector(".popup__submit-button"),n._submit=t,n}return t=u,(n=[{key:"_getInputValues",value:function(){var e=this;return this.newProfile={},Array.from(this._popup.querySelectorAll("".concat(r.inputSelector))).forEach((function(t){e.newProfile["".concat(t.name)]=t.value})),this.newProfile}},{key:"loadingResult",value:function(e){this._submitButton.textContent=e}},{key:"setEventListeners",value:function(){var e=this;k(P(u.prototype),"setEventListeners",this).call(this),this._popup.addEventListener("submit",(function(t){t.preventDefault(),e._submit(e._getInputValues())}))}},{key:"closePopup",value:function(){k(P(u.prototype),"closePopup",this).call(this),this._popup.querySelector(r.formSelector).reset()}}])&&b(t.prototype,n),o&&b(t,o),u}(s);function C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var j=function(){function e(t,n){var r=t.items,o=t.renderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderedItems=r,this.renderer=o,this._container=document.querySelector(n)}var t,n,r;return t=e,(n=[{key:"renderItems",value:function(){var e=this;this.renderedItems.forEach((function(t){return e.renderer(t)}))}},{key:"addItem",value:function(e){this._container.prepend(e)}},{key:"addItems",value:function(e){this._container.append(e)}}])&&C(t.prototype,n),r&&C(t,r),e}();function L(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var I=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._name=document.querySelector(t.name),this._object=document.querySelector(t.object),this._avatar=document.querySelector(t.avatar)}var t,n,r;return t=e,(n=[{key:"getUserInfo",value:function(){return this._profile={name:this._name.textContent,object:this._object.textContent},this._profile}},{key:"getUserAvatar",value:function(){return this._avatar.src}},{key:"setUserInfo",value:function(e){var t=e.name,n=e.object;this._name.textContent=t,this._object.textContent=n}},{key:"setUserAvatar",value:function(e){var t=e.avatar;this._avatar.src=t}}])&&L(t.prototype,n),r&&L(t,r),e}();function O(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var q=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=t.baseUrl,this.headers=t.headers}var t,n,r;return t=e,(n=[{key:"_handleResponse",value:function(e){return e.ok?e.json():Promise.reject(e.statusText)}},{key:"getUser",value:function(){return fetch("".concat(this.url,"/users/me"),{headers:this.headers}).then(this._handleResponse)}},{key:"getInitialCards",value:function(){return fetch("".concat(this.url,"/cards"),{headers:this.headers}).then(this._handleResponse)}},{key:"updateProfileInfo",value:function(e){return fetch("".concat(this.url,"/users/me"),{method:"PATCH",headers:this.headers,body:JSON.stringify({name:e.name,about:e.object})}).then(this._handleResponse)}},{key:"updateProfileAvatar",value:function(e){return fetch("".concat(this.url,"/users/me/avatar"),{method:"PATCH",headers:this.headers,body:JSON.stringify({avatar:e.object})}).then(this._handleResponse)}},{key:"createCard",value:function(e){return fetch("".concat(this.url,"/cards"),{method:"POST",headers:this.headers,body:JSON.stringify({name:e.name,link:e.object})}).then(this._handleResponse)}},{key:"deleteCard",value:function(e){return fetch("".concat(this.url,"/cards/").concat(e),{method:"DELETE",headers:this.headers}).then(this._handleResponse)}},{key:"createLike",value:function(e){return fetch("".concat(this.url,"/cards/likes/").concat(e),{method:"PUT",headers:this.headers}).then(this._handleResponse)}},{key:"deleteLike",value:function(e){return fetch("".concat(this.url,"/cards/likes/").concat(e),{method:"DELETE",headers:this.headers}).then(this._handleResponse)}}])&&O(t.prototype,n),r&&O(t,r),e}(),R=document.querySelector("#editPopup"),x=R.querySelector(".popup__container"),T=document.querySelector(".profile__edit-button"),B=document.querySelector("#addPopup"),A=B.querySelector(".popup__container"),U=document.querySelector(".profile__add-button"),D=R.querySelector(".popup__submit-button"),V=B.querySelector(".popup__submit-button"),M=document.querySelector("#name"),N=document.querySelector("#subject"),J=document.querySelector(".profile__overlay"),H=document.querySelector("#avatarPopup").querySelector("#source"),z=new q({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-13",headers:{authorization:"76346dd7-8de1-4cc7-a3b8-f91fff5a3b7d","Content-Type":"application/json"}}),F=new c(r,x);F.enableValidation();var G=new c(r,A);G.enableValidation();var K=new I({name:".profile__author",object:".profile__subject",avatar:".profile__img"}),Q=new v("#photo");Q.setEventListeners();var W=new w("#editPopup",(function(e){W.loadingResult("Сохранение..."),z.updateProfileInfo(e).then((function(e){K.setUserInfo({name:e.name,object:e.about})})).catch((function(e){console.log("Ошибка при изменении профиля: ".concat(e))})).finally((function(){W.closePopup(),W.loadingResult("Сохранить")}))}));W.setEventListeners();var X=new w("#avatarPopup",(function(e){X.loadingResult("Сохраняем..."),z.updateProfileAvatar(e).then((function(e){K.setUserAvatar(e)})).catch((function(e){console.log("Ошибка при загрузке аватарки: ".concat(e))})).finally((function(){X.closePopup(),X.loadingResult("Сохранить")}))}));X.setEventListeners();var Y=new w("#confirmPopup",(function(){Y.loadingResult("Удаляем...")}));Y.setEventListeners();var Z=function(e,t){var n=new i(e,"#photo-grid",t,Y,(function(){z.deleteCard(n.cardId).then((function(){n.deleteElement(),n.deleteListener()})).catch((function(e){console.log("Карточка не удаляется: ".concat(e))})).finally((function(){Y.closePopup(),Y.loadingResult("Да")}))}),(function(e){z.createLike(e).then((function(e){n.likes=e.likes,n.element.querySelector(".card__like-counter").textContent=e.likes.length})).catch((function(e){console.log("Ошибка в добавлении лайка: ".concat(e))}))}),(function(e){z.deleteLike(e).then((function(e){n.likes=e.likes,n.element.querySelector(".card__like-counter").textContent=e.likes.length})).catch((function(e){console.log("Ошибка в удалении лайка: ".concat(e))}))}),(function(){Q.openPopup(e)}));return n.generateCard()},$=new w("#addPopup",(function(e){$.loadingResult("Создание..."),z.createCard(e).then((function(e){var t=new j({items:[e],renderer:function(e){t.addItem(Z(e,e.owner._id))}},".cards");t.renderItems()})).catch((function(e){console.log("Ошибка при добавлении карточки: ".concat(e))})).finally((function(){$.closePopup(),$.loadingResult("Создать")}))}));$.setEventListeners(),z.getUser().then((function(e){return K.setUserInfo({name:e.name,object:e.about}),K.setUserAvatar(e),e._id})).then((function(e){z.getInitialCards().then((function(t){var n=new j({items:t,renderer:function(t){n.addItems(Z(t,e))}},".cards");n.renderItems()})).catch((function(e){console.log("Ошибка в рендере массива карт: ".concat(e))}))})).catch((function(e){console.log("Ошибка в полученных данных: ".concat(e))})),T.addEventListener("click",(function(){F.hideInputErrors(),F.onButton(D);var e=K.getUserInfo();M.value=e.name,N.value=e.object,W.openPopup()})),U.addEventListener("click",(function(){G.hideInputErrors(),G.offButton(V),$.openPopup()})),J.addEventListener("click",(function(){H.value=K.getUserAvatar(),X.openPopup()}))}]);